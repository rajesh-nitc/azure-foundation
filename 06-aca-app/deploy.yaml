# location: westus
# name: ca-bu1-app1-dev-westus
# resourceGroup: ${{ secrets.APP_BACKEND_CICD_RG_NAME }}
# type: Microsoft.App/containerApps
# tags:
#   tagname: value
# properties:
#   managedEnvironmentId: /subscriptions/${{ secrets.SUBSCRIPTION_ID }}/resourceGroups/${{ secrets.APP_BACKEND_CICD_RG_NAME }}/providers/Microsoft.App/managedEnvironments/cae-bu1-app1-dev-westus
#   configuration:
#     activeRevisionsMode: Single
#     # secrets:
#     #   - name: mysecret
#     #     value: thisismysecret
#     #   - name: myregistrypassword
#     #     value: I<3containerapps
#     ingress:
#       external: true
#       allowInsecure: false
#       targetPort: 3500
#       traffic:
#         - latestRevision: true
#           weight: 100
#       transport: Auto
#     registries:
#       - server: ${{ secrets.APP_BACKEND_CICD_ACR_NAME }}.azurecr.io
#         identity: ${{ secrets.APP_BACKEND_CICD_ACR_UAI_ID }}
#     # dapr:
#     #   appId: mycontainerapp
#     #   appPort: 80
#     #   appProtocol: http
#     #   enabled: true
#   template:
#     revisionSuffix: myrevision
#     containers:
#       - image: nginx
#         name: hello-world
#         # env:
#         #   - name: HTTP_PORT
#         #     value: 80
#         #   - name: secret_name
#         #     secretRef: mysecret
#         # command:
#         #   - npm
#         #   - start
#         resources:
#           cpu: 0.25
#           memory: 0.5Gi
#         # probes:
#         #   - type: liveness
#         #     httpGet:
#         #       path: "/health"
#         #       port: 8080
#         #       httpHeaders:
#         #         - name: "Custom-Header"
#         #           value: "liveness probe"
#         #     initialDelaySeconds: 7
#         #     periodSeconds: 3
#         #   - type: readiness
#         #     tcpSocket:
#         #       port: 8081
#         #     initialDelaySeconds: 10
#         #     periodSeconds: 3
#         #   - type: startup
#         #     httpGet:
#         #       path: "/startup"
#         #       port: 8080
#         #       httpHeaders:
#         #         - name: "Custom-Header"
#         #           value: "startup probe"
#         #     initialDelaySeconds: 3
#         #     periodSeconds: 3
#         # volumeMounts:
#         #   - mountPath: /myempty
#         #     volumeName: myempty
#         #   - mountPath: /myfiles
#         #     volumeName: azure-files-volume
#         #   - mountPath: /mysecrets
#         #     volumeName: mysecrets
#     scale:
#       minReplicas: 1
#       maxReplicas: 2
#     # volumes:
#     #   - name: myempty
#     #     storageType: EmptyDir
#     #   - name: azure-files-volume
#     #     storageType: AzureFile
#     #     storageName: myazurefiles
#     #   - name: mysecrets
#     #     storageType: Secret
#     #     secrets:
#     #       - secretRef: mysecret
#     #         path: mysecret.txt